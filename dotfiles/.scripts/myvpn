#!/usr/bin/env bash
CONNECTIONS="$(nmcli -g NAME,TYPE,ACTIVE connection show)"
ACTIVE="$(rg '.+:wireguard:yes$' <<<"${CONNECTIONS}")"
PEERS="$(rg '.+:wireguard:(yes|no)$' <<<"${CONNECTIONS}")"
PEER=$(fzf --prompt="Peer: " <<<"${PEERS}\nNone")
if [[ -n ${PEER} ]]; then
  if [[ -n "${ACTIVE}" || ${PEER} == "None" ]]; then
    echo "[#] Closing ${ACTIVE}"
    if nmcli c down "${ACTIVE}"; then
      echo "[+] Closed ${ACTIVE}"
    else
      echo "[!] Couldn't close ${ACTIVE}"
    fi
  fi
  if [[ "${PEER}" != "None" ]]; then
    echo "[#] Opening ${PEER}"
    if nmcli c up "${PEER}"; then
      echo "[+] Opened ${PEER}"
    else
      echo "[!] Couldn't open ${PEER}"
    fi
  fi
fi
